<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBå¯è½‰å‚µç™¼è¡Œè³‡æ–™æŸ¥è©¢ç³»çµ± - Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            min-height: 100vh;
            padding: 0;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        .header h1 { font-size: 2.2em; margin-bottom: 15px; }
        .header .subtitle { font-size: 1.05em; opacity: 0.95; margin-bottom: 25px; }
        
        .top-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .top-btn {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 0.95em;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .top-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
        }
        .header .author {
            margin-top: 15px;
            font-size: 0.9em;
            opacity: 0.85;
            font-style: italic;
        }
        
        .loading-banner {
            background: #fffbf0;
            border-bottom: 3px solid #ffc107;
            padding: 15px 20px;
            text-align: center;
            color: #856404;
            font-size: 1em;
        }
        .loading-banner.success {
            background: #f0fff4;
            border-bottom: 3px solid #28a745;
            color: #155724;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 0;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }
        
        .tab-navigation {
            display: flex;
            background: white;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
        }
        .tab-btn {
            flex: 1;
            padding: 18px 12px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-family: 'Microsoft JhengHei', Arial;
            transition: all 0.3s;
            position: relative;
            min-width: 130px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        .tab-btn .icon { font-size: 1.8em; }
        .tab-btn:hover { background: #f8f9fa; }
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }
        
        .tab-content { display: none; padding: 40px; min-height: 500px; }
        .tab-content.active { display: block; }
        
        .search-section { max-width: 800px; margin: 0 auto 40px; }
        .search-box { display: flex; gap: 15px; }
        .search-box input {
            flex: 1;
            padding: 15px 20px;
            font-size: 1.3em;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-family: 'Microsoft JhengHei', Arial;
        }
        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .search-box button {
            padding: 15px 40px;
            font-size: 1.3em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .search-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .info-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 5px solid #2196f3;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .info-card h3 { color: #1565c0; margin-bottom: 10px; font-size: 1.3em; }
        .info-card p { color: #0d47a1; line-height: 1.8; margin: 5px 0; font-size: 1.05em; }
        
        .summary-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        .summary-card h3 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: -25px -25px 20px -25px;
            font-size: 1.3em;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .detail-item {
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .detail-item .label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }
        .detail-item .value {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        .detail-item.highlight {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left-color: #ff9800;
        }
        .detail-item.highlight .value {
            color: #e65100;
        }
        
        .table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 0.95em;
        }
        thead {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        th {
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9em;
            white-space: nowrap;
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        th:last-child { border-right: none; }
        td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
            border-right: 1px solid #f0f0f0;
        }
        td:last-child { border-right: none; }
        tbody tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .badge-green { background: #c8e6c9; color: #1b5e20; }
        .badge-blue { background: #bbdefb; color: #0d47a1; }
        .badge-orange { background: #ffe0b2; color: #e65100; }
        .badge-red { background: #ffcdd2; color: #b71c1c; }
        .badge-purple { background: #e1bee7; color: #4a148c; }
        
        .price-high { background: #ffcdd2; color: #b71c1c; font-weight: bold; }
        .price-low { background: #c8e6c9; color: #1b5e20; font-weight: bold; }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.3em;
            color: #667eea;
        }
        
        .error-message {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.1em;
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            background: white;
            color: #667eea;
            font-size: 1em;
            border-top: 2px solid #e0e0e0;
        }
        .footer p { margin: 5px 0; }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 1.6em; }
            .top-buttons { flex-direction: column; }
            .search-box { flex-direction: column; }
            .detail-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“‹ CBå¯è½‰å‚µç™¼è¡Œè³‡æ–™åŠæ›ç‰Œå¾Œé«˜ä½åƒ¹æ ¼æŸ¥è©¢å·¥å…·</h1>
        <div class="subtitle">ç™¼è¡Œæ¢ä»¶ | è½‰æ›åƒ¹æ ¼ | æ›ç‰Œå¾Œè¡¨ç¾ | è´–å›è³£å›æ¢ä»¶</div>
        
        <div class="top-buttons">
            <a href="#" class="top-btn" id="loadDataBtn">ğŸ“¥ è¼‰å…¥ä¸­...</a>
            <a href="https://vocus.cc/user/@rexdashu168" target="_blank" class="top-btn">ğŸ“ æ–¹æ ¼å­éƒ¨è½æ ¼</a>
            <a href="https://www.youtube.com/@RexCB168" target="_blank" class="top-btn">ğŸ“º YouTubeé »é“</a>
        </div>
        
        <div class="author">by Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤</div>
    </div>
    
    <div id="loadingBanner" class="loading-banner">
        ğŸ“¥ æ­£åœ¨è¼‰å…¥å¯è½‰å‚µç™¼è¡Œè³‡æ–™...
    </div>
    
    <div class="container">
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="showTab('manual')">
                <span class="icon">âœï¸</span>
                <span>æ‰‹å‹•æŸ¥è©¢</span>
            </button>
            <button class="tab-btn" onclick="showTab('auto')">
                <span class="icon">ğŸ”„</span>
                <span>è‡ªå‹•æ›´æ–°</span>
            </button>
            <button class="tab-btn" onclick="showTab('list')">
                <span class="icon">ğŸ“‹</span>
                <span>å®Œæ•´æ¸…å–®</span>
            </button>
            <button class="tab-btn" onclick="showTab('expiry')">
                <span class="icon">â°</span>
                <span>åˆ°æœŸæ—¥æŸ¥è©¢</span>
            </button>
        </div>
        
        <!-- æ‰‹å‹•æŸ¥è©¢ -->
        <div id="manualTab" class="tab-content active">
            <div class="info-card">
                <h3>ğŸ’¡ åŠŸèƒ½èªªæ˜</h3>
                <p>æŸ¥è©¢æ–¹å¼: è¼¸å…¥CBä»£è™Ÿ(5ä½æ•¸)ç«‹å³æŸ¥è©¢è©²æª”CBçš„å®Œæ•´è³‡æ–™</p>
                <p>é¡¯ç¤ºå…§å®¹: ç™¼è¡ŒåŸºæœ¬è³‡æ–™ã€æ›ç‰Œå¾Œæœ€é«˜/æœ€ä½åƒ¹ã€è³£å›æ¢ä»¶ç­‰</p>
                <p>ä½¿ç”¨ç¯„ä¾‹: è¼¸å…¥ã€Œ33902ã€æŸ¥è©¢æ—­è»ŸäºŒçš„å®Œæ•´è³‡æ–™</p>
            </div>
            
            <div class="search-section">
                <div class="search-box">
                    <input type="text" id="manualCode" placeholder="è¼¸å…¥CBä»£è™Ÿ(ä¾‹å¦‚: 33902)" maxlength="5">
                    <button onclick="searchManual()">æŸ¥è©¢</button>
                </div>
            </div>
            
            <div id="result1"></div>
        </div>
        
        <!-- è‡ªå‹•æ›´æ–° -->
        <div id="autoTab" class="tab-content">
            <div class="info-card">
                <h3>ğŸ’¡ åŠŸèƒ½èªªæ˜</h3>
                <p>æŸ¥è©¢æ–¹å¼: è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ,è‡ªå‹•åˆ—å‡ºè©²å…¬å¸æ‰€æœ‰ç™¼è¡Œéçš„CB</p>
                <p>é¡¯ç¤ºå…§å®¹: è©²å…¬å¸æ­·æ¬¡ç™¼è¡Œçš„CBæ¸…å–®åŠæ›ç‰Œå¾Œè¡¨ç¾</p>
                <p>ä½¿ç”¨ç¯„ä¾‹: è¼¸å…¥ã€Œ3390ã€æŸ¥è©¢æ—­è»Ÿæ‰€æœ‰ç™¼è¡Œéçš„CB</p>
            </div>
            
            <div class="search-section">
                <div class="search-box">
                    <input type="text" id="autoCode" placeholder="è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ(ä¾‹å¦‚: 3390)" maxlength="4">
                    <button onclick="searchAuto()">æŸ¥è©¢</button>
                </div>
            </div>
            
            <div id="result2"></div>
        </div>
        
        <!-- å®Œæ•´æ¸…å–® -->
        <div id="listTab" class="tab-content">
            <div class="info-card">
                <h3>ğŸ’¡ åŠŸèƒ½èªªæ˜</h3>
                <p>é¡¯ç¤ºæ‰€æœ‰å¯è½‰å‚µçš„ç™¼è¡Œè³‡æ–™åŠæ›ç‰Œå¾Œè¡¨ç¾</p>
                <p>é»æ“Šä»»ä¸€åˆ—å¯æŸ¥çœ‹è©²CBçš„å®Œæ•´è©³ç´°è³‡æ–™</p>
            </div>
            
            <div id="result3"></div>
        </div>
        
        <!-- åˆ°æœŸæ—¥æŸ¥è©¢ -->
        <div id="expiryTab" class="tab-content">
            <div class="info-card">
                <h3>ğŸ’¡ åŠŸèƒ½èªªæ˜</h3>
                <p>æŸ¥è©¢å³å°‡åˆ°æœŸçš„å¯è½‰å‚µæ¸…å–®</p>
                <p>ä¾å‰©é¤˜å¤©æ•¸æ’åº,æä¾›åˆ°æœŸæ—¥æé†’åŠŸèƒ½</p>
            </div>
            
            <div class="search-section">
                <div class="search-box" style="max-width: 400px;">
                    <select id="expiryFilter" style="flex: 1; padding: 15px; font-size: 1.2em; border: 2px solid #ddd; border-radius: 10px;">
                        <option value="30">30å¤©å…§åˆ°æœŸ</option>
                        <option value="90">90å¤©å…§åˆ°æœŸ</option>
                        <option value="180">180å¤©å…§åˆ°æœŸ</option>
                        <option value="365">1å¹´å…§åˆ°æœŸ</option>
                        <option value="all">å…¨éƒ¨é¡¯ç¤º</option>
                    </select>
                    <button onclick="searchExpiry()">æŸ¥è©¢</button>
                </div>
            </div>
            
            <div id="result4"></div>
        </div>
        
        <div class="footer">
            <p>Â© 2025 Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤ | CBå¯è½‰å‚µç™¼è¡Œè³‡æ–™æŸ¥è©¢ç³»çµ± v1.0</p>
            <p style="margin-top: 8px; opacity: 0.8;">è³‡æ–™åƒ…ä¾›åƒè€ƒ | æŠ•è³‡æœ‰é¢¨éšªï¼Œå…¥å¸‚éœ€è¬¹æ…</p>
        </div>
    </div>

    <script>
        let cbData = null;
        const COL = {
            åº: 0, è‚¡ç¥¨ä»£ç¢¼: 1, CBä»£ç¢¼: 2, CBåç¨±: 3, TCRIæ“”ä¿: 4, æ“”ä¿: 5, é¡åº¦å„„: 6,
            ç™¼è¡Œè½‰æ›åƒ¹æ ¼: 7, æ›ç‰Œæ—¥æœŸ: 8, åˆ°æœŸæ—¥: 9, å¹´æœŸ: 10, æœ€é«˜åƒ¹: 11, æœ€ä½åƒ¹: 12,
            æº¢åƒ¹è½‰æ›ç‡: 13, è‚¡æœ¬: 14, è©¢åœˆç«¶æ‹: 15, æ‰¿éŠ·å•†: 16, è‘£äº‹æœƒ: 17, é€ä»¶æ—¥: 18,
            ç”Ÿæ•ˆæ—¥: 19, è©¢åœˆç«¶æ‹æ—¥: 20, å…¬å‘Šä»£æ”¶åƒ¹æ¬¾: 21, æ›ç‰Œæ—¥: 22, CBASæ‹†è§£æ—¥: 23,
            è³£å›æ—¥1: 24, è³£å›æ—¥2: 25, è³£å›åƒ¹1: 26, è³£å›åƒ¹2: 27, è³£å›æ®–åˆ©ç‡1: 28,
            è³£å›æ®–åˆ©ç‡2: 29, æå‰è³£å›æ¢ä»¶: 30, è³£å›æ¢ä»¶: 31, ç”¢æ¥­åˆ†é¡: 32, ç”¢æ¥­åœ°ä½: 33,
            è³‡é‡‘ç”¨é€”: 34, ç™¼è¡Œåƒ¹æ ¼: 35, åˆ°æœŸé‚„æœ¬åƒ¹: 36, è½‰æ›é–‹å§‹æ—¥: 37, æœ€æ–°è½‰æ›åƒ¹: 38,
            æœ€å¾Œè‚¡ç¥¨åƒ¹æ ¼: 39, CBåƒè€ƒåƒ¹æ ¼: 40, æ–°è½‰æ›åƒ¹ç”Ÿæ•ˆæ—¥: 41, CBæœ€æ–°é¤˜é¡: 42,
            æœ€è¿‘è³£å›æ¬Šé–‹å§‹: 43, æœ€è¿‘è³£å›æ¬ŠçµæŸ: 44, æœ€è¿‘è³£å›æ¬Šåƒ¹æ ¼: 45,
            å…¬å¸å¼·åˆ¶è´–å›é–‹å§‹: 46, å…¬å¸å¼·åˆ¶è´–å›çµæŸ: 47, å¼·åˆ¶è´–å›åƒ¹æ ¼: 48, çµ‚æ­¢æ«ƒæª¯è²·è³£æ—¥: 49
        };
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            const tabs = ['manual', 'auto', 'list', 'expiry'];
            const index = tabs.indexOf(tabName);
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            document.querySelectorAll('.tab-btn')[index].classList.add('active');
            
            if (tabName === 'list' && cbData) {
                showFullList();
            }
        }
        
        window.onload = function() {
            loadExcelFile();
        };
        
        async function loadExcelFile() {
            const banner = document.getElementById('loadingBanner');
            const loadBtn = document.getElementById('loadDataBtn');
            
            try {
                const response = await fetch('cb_issue.xlsx');
                if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥æª”æ¡ˆ');
                
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, {type: 'array'});
                
                const sheet = workbook.Sheets['allcbissue'];
                if (!sheet) throw new Error('æ‰¾ä¸åˆ°allcbissueå·¥ä½œè¡¨');
                
                cbData = XLSX.utils.sheet_to_json(sheet, {header: 1});
                const cbCount = cbData.length - 1;
                
                banner.className = 'loading-banner success';
                banner.textContent = `âœ… è³‡æ–™è¼‰å…¥æˆåŠŸ | å¯è½‰å‚µç¸½æ•¸: ${cbCount} æª”`;
                
                loadBtn.textContent = 'âœ… è¼‰å…¥å®Œæˆ';
                loadBtn.style.background = 'rgba(40, 167, 69, 0.3)';
                
            } catch (error) {
                banner.className = 'loading-banner';
                banner.style.background = '#f8d7da';
                banner.style.borderColor = '#dc3545';
                banner.style.color = '#721c24';
                banner.textContent = `âŒ è¼‰å…¥å¤±æ•—: ${error.message}`;
                
                loadBtn.textContent = 'âŒ è¼‰å…¥å¤±æ•—';
                loadBtn.style.background = 'rgba(220, 53, 69, 0.3)';
            }
        }
        
        function searchManual() {
            const code = document.getElementById('manualCode').value.trim();
            if (!code) { alert('è«‹è¼¸å…¥CBä»£è™Ÿ'); return; }
            if (!cbData) { alert('è³‡æ–™å°šæœªè¼‰å…¥'); return; }
            
            document.getElementById('result1').innerHTML = '<div class="loading">æŸ¥è©¢ä¸­...</div>';
            
            setTimeout(() => {
                let found = null;
                for (let i = 1; i < cbData.length; i++) {
                    if (String(cbData[i][COL.CBä»£ç¢¼]).trim() === code) {
                        found = cbData[i];
                        break;
                    }
                }
                
                if (!found) {
                    document.getElementById('result1').innerHTML = 
                        '<div class="error-message"><h3>æ‰¾ä¸åˆ°CBä»£è™Ÿ: ' + code + '</h3></div>';
                    return;
                }
                
                displaySingleDetail(found, 'result1');
            }, 300);
        }
        
        function displaySingleDetail(row, targetId) {
            const highest = parseFloat(row[COL.æœ€é«˜åƒ¹]) || 0;
            const lowest = parseFloat(row[COL.æœ€ä½åƒ¹]) || 0;
            const swing = highest && lowest ? ((highest - lowest) / lowest * 100).toFixed(1) : '0.0';
            
            const html = `
                <div class="summary-card">
                    <h3>${row[COL.CBä»£ç¢¼]} ${row[COL.CBåç¨±]}</h3>
                    <div class="detail-grid">
                        <div class="detail-item highlight">
                            <div class="label">è¦æ¨¡</div>
                            <div class="value">${row[COL.é¡åº¦å„„] || '-'} å„„</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">æ“”ä¿</div>
                            <div class="value">${row[COL.æ“”ä¿] || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">å¹´æœŸ</div>
                            <div class="value">${row[COL.å¹´æœŸ] || '-'} å¹´</div>
                        </div>
                        <div class="detail-item highlight">
                            <div class="label">è½‰æ›åƒ¹</div>
                            <div class="value">${row[COL.æœ€æ–°è½‰æ›åƒ¹] || row[COL.ç™¼è¡Œè½‰æ›åƒ¹æ ¼] || '-'} å…ƒ</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">è©¢åœˆ/ç«¶æ‹</div>
                            <div class="value">${row[COL.è©¢åœˆç«¶æ‹] || '-'}</div>
                        </div>
                        <div class="detail-item ${highest > 130 ? 'highlight' : ''}">
                            <div class="label">æœ€é«˜åƒ¹</div>
                            <div class="value">${row[COL.æœ€é«˜åƒ¹] || '-'}</div>
                        </div>
                        <div class="detail-item ${lowest < 100 ? 'highlight' : ''}">
                            <div class="label">æœ€ä½åƒ¹</div>
                            <div class="value">${row[COL.æœ€ä½åƒ¹] || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">æŒ¯å¹…</div>
                            <div class="value">${swing}%</div>
                        </div>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>è³£å›è³‡è¨Š</h3>
                    <div class="table-wrapper">
                        <table style="font-size: 1em;">
                            <thead>
                                <tr>
                                    <th>è³£å›æ¬¡æ•¸</th>
                                    <th>æ—¥æœŸ</th>
                                    <th>åƒ¹æ ¼</th>
                                    <th>åˆ©ç‡</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>è³£å›1</strong></td>
                                    <td>${row[COL.è³£å›æ—¥1] || '-'}</td>
                                    <td><strong>${row[COL.è³£å›åƒ¹1] || '-'}</strong></td>
                                    <td>${row[COL.è³£å›æ®–åˆ©ç‡1] || '-'}%</td>
                                </tr>
                                <tr>
                                    <td><strong>è³£å›2</strong></td>
                                    <td>${row[COL.è³£å›æ—¥2] || '-'}</td>
                                    <td><strong>${row[COL.è³£å›åƒ¹2] || '-'}</strong></td>
                                    <td>${row[COL.è³£å›æ®–åˆ©ç‡2] || '-'}%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById(targetId).innerHTML = html;
        }
        
        function searchAuto() {
            const code = document.getElementById('autoCode').value.trim();
            if (!code) { alert('è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ'); return; }
            if (!cbData) { alert('è³‡æ–™å°šæœªè¼‰å…¥'); return; }
            
            document.getElementById('result2').innerHTML = '<div class="loading">æŸ¥è©¢ä¸­...</div>';
            
            setTimeout(() => {
                const results = [];
                for (let i = 1; i < cbData.length; i++) {
                    if (String(cbData[i][COL.è‚¡ç¥¨ä»£ç¢¼]).trim() === code) {
                        results.push(cbData[i]);
                    }
                }
                
                if (results.length === 0) {
                    document.getElementById('result2').innerHTML = 
                        '<div class="error-message"><h3>æŸ¥ç„¡è³‡æ–™: è‚¡ç¥¨ä»£è™Ÿ ' + code + '</h3></div>';
                    return;
                }
                
                let html = `
                    <div class="summary-card">
                        <h3>è‚¡ç¥¨ä»£è™Ÿ ${code} çš„æ‰€æœ‰CBç™¼è¡Œè¨˜éŒ„ (å…±${results.length}æª”)</h3>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>CBä»£è™Ÿ</th>
                                    <th>CBåç¨±</th>
                                    <th>è¦æ¨¡</th>
                                    <th>æ“”ä¿</th>
                                    <th>å¹´æœŸ</th>
                                    <th>è½‰æ›åƒ¹</th>
                                    <th>è©¢åœˆ/ç«¶æ‹</th>
                                    <th>æœ€é«˜åƒ¹</th>
                                    <th>æœ€ä½åƒ¹</th>
                                    <th>æŒ¯å¹…</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                results.forEach(row => {
                    const highest = parseFloat(row[COL.æœ€é«˜åƒ¹]) || 0;
                    const lowest = parseFloat(row[COL.æœ€ä½åƒ¹]) || 0;
                    const swing = highest && lowest ? ((highest - lowest) / lowest * 100).toFixed(1) : '-';
                    
                    html += `
                        <tr>
                            <td><strong>${row[COL.CBä»£ç¢¼]}</strong></td>
                            <td>${row[COL.CBåç¨±]}</td>
                            <td>${row[COL.é¡åº¦å„„]}å„„</td>
                            <td><span class="badge ${row[COL.æ“”ä¿] === 'æœ‰æ“”ä¿' ? 'badge-green' : 'badge-orange'}">${row[COL.æ“”ä¿] || '-'}</span></td>
                            <td>${row[COL.å¹´æœŸ]}å¹´</td>
                            <td><strong>${row[COL.æœ€æ–°è½‰æ›åƒ¹] || row[COL.ç™¼è¡Œè½‰æ›åƒ¹æ ¼]}å…ƒ</strong></td>
                            <td><span class="badge ${row[COL.è©¢åœˆç«¶æ‹] === 'ç«¶æ‹' ? 'badge-blue' : 'badge-green'}">${row[COL.è©¢åœˆç«¶æ‹] || '-'}</span></td>
                            <td class="price-high">${row[COL.æœ€é«˜åƒ¹] || '-'}</td>
                            <td class="price-low">${row[COL.æœ€ä½åƒ¹] || '-'}</td>
                            <td><strong>${swing}${swing !== '-' ? '%' : ''}</strong></td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table></div>';
                document.getElementById('result2').innerHTML = html;
            }, 300);
        }
        
        function showFullList() {
            if (!cbData) return;
            
            let html = `
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>CBä»£è™Ÿ</th>
                                <th>CBåç¨±</th>
                                <th>è¦æ¨¡</th>
                                <th>æ“”ä¿</th>
                                <th>å¹´æœŸ</th>
                                <th>è½‰æ›åƒ¹</th>
                                <th>æ›ç‰Œæ—¥</th>
                                <th>åˆ°æœŸæ—¥</th>
                                <th>æœ€é«˜åƒ¹</th>
                                <th>æœ€ä½åƒ¹</th>
                                <th>æŒ¯å¹…</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            for (let i = 1; i < cbData.length; i++) {
                const row = cbData[i];
                const highest = parseFloat(row[COL.æœ€é«˜åƒ¹]) || 0;
                const lowest = parseFloat(row[COL.æœ€ä½åƒ¹]) || 0;
                const swing = highest && lowest ? ((highest - lowest) / lowest * 100).toFixed(1) : '-';
                
                html += `
                    <tr>
                        <td><strong>${row[COL.CBä»£ç¢¼]}</strong></td>
                        <td>${row[COL.CBåç¨±]}</td>
                        <td>${row[COL.é¡åº¦å„„]}å„„</td>
                        <td><span class="badge ${row[COL.æ“”ä¿] === 'æœ‰æ“”ä¿' ? 'badge-green' : 'badge-orange'}">${row[COL.æ“”ä¿] || '-'}</span></td>
                        <td>${row[COL.å¹´æœŸ]}å¹´</td>
                        <td>${row[COL.æœ€æ–°è½‰æ›åƒ¹] || row[COL.ç™¼è¡Œè½‰æ›åƒ¹æ ¼]}å…ƒ</td>
                        <td>${row[COL.æ›ç‰Œæ—¥æœŸ] || '-'}</td>
                        <td>${row[COL.åˆ°æœŸæ—¥] || '-'}</td>
                        <td class="price-high">${row[COL.æœ€é«˜åƒ¹] || '-'}</td>
                        <td class="price-low">${row[COL.æœ€ä½åƒ¹] || '-'}</td>
                        <td><strong>${swing}${swing !== '-' ? '%' : ''}</strong></td>
                    </tr>
                `;
            }
            
            html += '</tbody></table></div>';
            document.getElementById('result3').innerHTML = html;
        }
        
        function searchExpiry() {
            if (!cbData) { alert('è³‡æ–™å°šæœªè¼‰å…¥'); return; }
            
            const filterDays = document.getElementById('expiryFilter').value;
            const today = new Date();
            const results = [];
            
            for (let i = 1; i < cbData.length; i++) {
                const row = cbData[i];
                const expiryStr = row[COL.åˆ°æœŸæ—¥];
                if (!expiryStr) continue;
                
                const expiry = new Date(expiryStr);
                const diff = Math.floor((expiry - today) / (1000 * 60 * 60 * 24));
                
                if (filterDays === 'all' || diff <= parseInt(filterDays)) {
                    results.push({ row: row, days: diff });
                }
            }
            
            results.sort((a, b) => a.days - b.days);
            
            let html = `
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>CBä»£è™Ÿ</th>
                                <th>CBåç¨±</th>
                                <th>åˆ°æœŸæ—¥</th>
                                <th>å‰©é¤˜å¤©æ•¸</th>
                                <th>å¹´æœŸ</th>
                                <th>æ›ç‰Œæ—¥</th>
                                <th>è½‰æ›åƒ¹</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            results.forEach(r => {
                const badgeClass = r.days < 30 ? 'badge-red' : 
                                   r.days < 90 ? 'badge-orange' : 
                                   r.days < 180 ? 'badge-blue' : 'badge-green';
                html += `
                    <tr>
                        <td><strong>${r.row[COL.CBä»£ç¢¼]}</strong></td>
                        <td>${r.row[COL.CBåç¨±]}</td>
                        <td>${r.row[COL.åˆ°æœŸæ—¥]}</td>
                        <td><span class="badge ${badgeClass}">${r.days} å¤©</span></td>
                        <td>${r.row[COL.å¹´æœŸ]}å¹´</td>
                        <td>${r.row[COL.æ›ç‰Œæ—¥æœŸ]}</td>
                        <td>${r.row[COL.æœ€æ–°è½‰æ›åƒ¹] || r.row[COL.ç™¼è¡Œè½‰æ›åƒ¹æ ¼]}å…ƒ</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            document.getElementById('result4').innerHTML = html || '<div class="error-message">æŸ¥ç„¡ç¬¦åˆæ¢ä»¶çš„è³‡æ–™</div>';
        }
        
        document.getElementById('manualCode').addEventListener('keypress', e => {
            if (e.key === 'Enter') searchManual();
        });
        document.getElementById('autoCode').addEventListener('keypress', e => {
            if (e.key === 'Enter') searchAuto();
        });
    </script>
</body>
</html>
