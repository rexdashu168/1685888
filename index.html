<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBÂèØËΩâÂÇµÁôºË°åË≥áÊñôÊü•Ë©¢Á≥ªÁµ± - RexÂ§ßÂèîÁöÑ168Âè∞ËÇ°ÊäïË≥áÊïôÂÆ§</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            min-height: 100vh;
            padding: 0;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        .header h1 { font-size: 2.2em; margin-bottom: 15px; }
        .header .subtitle { font-size: 1.05em; opacity: 0.95; margin-bottom: 25px; }
        
        .top-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .top-btn {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 0.95em;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .top-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
        }
        .header .author {
            margin-top: 15px;
            font-size: 0.9em;
            opacity: 0.85;
            font-style: italic;
        }
        
        .loading-banner {
            background: #fffbf0;
            border-bottom: 3px solid #ffc107;
            padding: 15px 20px;
            text-align: center;
            color: #856404;
            font-size: 1em;
        }
        .loading-banner.success {
            background: #f0fff4;
            border-bottom: 3px solid #28a745;
            color: #155724;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 0;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }
        
        .tab-navigation {
            display: flex;
            background: white;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
        }
        .tab-btn {
            flex: 1;
            padding: 18px 12px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-family: 'Microsoft JhengHei', Arial;
            transition: all 0.3s;
            position: relative;
            min-width: 130px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        .tab-btn .icon { font-size: 1.8em; }
        .tab-btn:hover { background: #f8f9fa; }
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }
        
        .tab-content { display: none; padding: 40px; min-height: 500px; }
        .tab-content.active { display: block; }
        
        .search-section { max-width: 800px; margin: 0 auto 40px; }
        .search-box { display: flex; gap: 15px; }
        .search-box input {
            flex: 1;
            padding: 15px 20px;
            font-size: 1.3em;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-family: 'Microsoft JhengHei', Arial;
        }
        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .search-box button {
            padding: 15px 40px;
            font-size: 1.3em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .search-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .info-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 5px solid #2196f3;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .info-card h3 { color: #1565c0; margin-bottom: 10px; font-size: 1.3em; }
        .info-card p { color: #0d47a1; line-height: 1.8; margin: 5px 0; font-size: 1.05em; }
        
        .summary-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        .summary-card h3 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: -25px -25px 20px -25px;
            font-size: 1.3em;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .detail-item {
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .detail-item .label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }
        .detail-item .value {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        .detail-item.highlight {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left-color: #ff9800;
        }
        .detail-item.highlight .value {
            color: #e65100;
        }
        
        .table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 0.95em;
        }
        thead {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        th {
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9em;
            white-space: nowrap;
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        th:last-child { border-right: none; }
        td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
            border-right: 1px solid #f0f0f0;
        }
        td:last-child { border-right: none; }
        tbody tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .badge-green { background: #c8e6c9; color: #1b5e20; }
        .badge-blue { background: #bbdefb; color: #0d47a1; }
        .badge-orange { background: #ffe0b2; color: #e65100; }
        .badge-red { background: #ffcdd2; color: #b71c1c; }
        .badge-purple { background: #e1bee7; color: #4a148c; }
        
        .price-high { background: #ffcdd2; color: #b71c1c; font-weight: bold; }
        .price-low { background: #c8e6c9; color: #1b5e20; font-weight: bold; }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.3em;
            color: #667eea;
        }
        
        .error-message {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.1em;
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            background: white;
            color: #667eea;
            font-size: 1em;
            border-top: 2px solid #e0e0e0;
        }
        .footer p { margin: 5px 0; }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 1.6em; }
            .top-buttons { flex-direction: column; }
            .search-box { flex-direction: column; }
            .detail-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìã CBÂèØËΩâÂÇµÁôºË°åË≥áÊñôÂèäÊéõÁâåÂæåÈ´ò‰ΩéÂÉπÊ†ºÊü•Ë©¢Â∑•ÂÖ∑</h1>
        <div class="subtitle">ÁôºË°åÊ¢ù‰ª∂ | ËΩâÊèõÂÉπÊ†º | ÊéõÁâåÂæåË°®Áèæ | Ë¥ñÂõûË≥£ÂõûÊ¢ù‰ª∂</div>
        
        <div class="top-buttons">
            <a href="#" class="top-btn" id="loadDataBtn">üì• ËºâÂÖ•‰∏≠...</a>
            <a href="https://vocus.cc/user/@rexdashu168" target="_blank" class="top-btn">üìù ÊñπÊ†ºÂ≠êÈÉ®ËêΩÊ†º</a>
            <a href="https://www.youtube.com/@RexCB168" target="_blank" class="top-btn">üì∫ YouTubeÈ†ªÈÅì</a>
        </div>
        
        <div class="author">by RexÂ§ßÂèîÁöÑ168Âè∞ËÇ°ÊäïË≥áÊïôÂÆ§</div>
    </div>
    
    <div id="loadingBanner" class="loading-banner">
        üì• Ê≠£Âú®ËºâÂÖ•ÂèØËΩâÂÇµÁôºË°åË≥áÊñô...
    </div>
    
    <div class="container">
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="showTab('manual')">
                <span class="icon">‚úçÔ∏è</span>
                <span>ÊâãÂãïÊü•Ë©¢</span>
            </button>
            <button class="tab-btn" onclick="showTab('auto')">
                <span class="icon">üîÑ</span>
                <span>Ëá™ÂãïÊõ¥Êñ∞</span>
            </button>
            <button class="tab-btn" onclick="showTab('list')">
                <span class="icon">üìã</span>
                <span>ÂÆåÊï¥Ê∏ÖÂñÆ</span>
            </button>
            <button class="tab-btn" onclick="showTab('expiry')">
                <span class="icon">‚è∞</span>
                <span>Âà∞ÊúüÊó•Êü•Ë©¢</span>
            </button>
        </div>
        
        <!-- ÊâãÂãïÊü•Ë©¢ -->
        <div id="manualTab" class="tab-content active">
            <div class="info-card">
                <h3>üí° ÂäüËÉΩË™™Êòé</h3>
                <p>Êü•Ë©¢ÊñπÂºè: Ëº∏ÂÖ•CB‰ª£Ëôü(5‰ΩçÊï∏)Á´ãÂç≥Êü•Ë©¢Ë©≤Ê™îCBÁöÑÂÆåÊï¥Ë≥áÊñô</p>
                <p>È°ØÁ§∫ÂÖßÂÆπ: ÁôºË°åÂü∫Êú¨Ë≥áÊñô„ÄÅÊéõÁâåÂæåÊúÄÈ´ò/ÊúÄ‰ΩéÂÉπ„ÄÅË≥£ÂõûÊ¢ù‰ª∂Á≠â</p>
                <p>‰ΩøÁî®ÁØÑ‰æã: Ëº∏ÂÖ•„Äå33902„ÄçÊü•Ë©¢Êó≠Ëªü‰∫åÁöÑÂÆåÊï¥Ë≥áÊñô</p>
            </div>
            
            <div class="search-section">
                <div class="search-box">
                    <input type="text" id="manualCode" placeholder="Ëº∏ÂÖ•CB‰ª£Ëôü(‰æãÂ¶Ç: 33902)" maxlength="5">
                    <button onclick="searchManual()">Êü•Ë©¢</button>
                </div>
            </div>
            
            <div id="result1"></div>
        </div>
        
        <!-- Ëá™ÂãïÊõ¥Êñ∞ -->
        <div id="autoTab" class="tab-content">
            <div class="info-card">
                <h3>üí° ÂäüËÉΩË™™Êòé</h3>
                <p>Êü•Ë©¢ÊñπÂºè: Ëº∏ÂÖ•ËÇ°Á•®‰ª£Ëôü,Ëá™ÂãïÂàóÂá∫Ë©≤ÂÖ¨Âè∏ÊâÄÊúâÁôºË°åÈÅéÁöÑCB</p>
                <p>È°ØÁ§∫ÂÖßÂÆπ: Ë©≤ÂÖ¨Âè∏Ê≠∑Ê¨°ÁôºË°åÁöÑCBÊ∏ÖÂñÆÂèäÊéõÁâåÂæåË°®Áèæ</p>
                <p>‰ΩøÁî®ÁØÑ‰æã: Ëº∏ÂÖ•„Äå3390„ÄçÊü•Ë©¢Êó≠ËªüÊâÄÊúâÁôºË°åÈÅéÁöÑCB</p>
            </div>
            
            <div class="search-section">
                <div class="search-box">
                    <input type="text" id="autoCode" placeholder="Ëº∏ÂÖ•ËÇ°Á•®‰ª£Ëôü(‰æãÂ¶Ç: 3390)" maxlength="4">
                    <button onclick="searchAuto()">Êü•Ë©¢</button>
                </div>
            </div>
            
            <div id="result2"></div>
        </div>
        
        <!-- ÂÆåÊï¥Ê∏ÖÂñÆ -->
        <div id="listTab" class="tab-content">
            <div class="info-card">
                <h3>üí° ÂäüËÉΩË™™Êòé</h3>
                <p>È°ØÁ§∫ÊâÄÊúâÂèØËΩâÂÇµÁöÑÁôºË°åË≥áÊñôÂèäÊéõÁâåÂæåË°®Áèæ</p>
                <p>ÈªûÊìä‰ªª‰∏ÄÂàóÂèØÊü•ÁúãË©≤CBÁöÑÂÆåÊï¥Ë©≥Á¥∞Ë≥áÊñô</p>
            </div>
            
            <div id="result3"></div>
        </div>
        
        <!-- Âà∞ÊúüÊó•Êü•Ë©¢ -->
        <div id="expiryTab" class="tab-content">
            <div class="info-card">
                <h3>üí° ÂäüËÉΩË™™Êòé</h3>
                <p>Êü•Ë©¢Âç≥Â∞áÂà∞ÊúüÁöÑÂèØËΩâÂÇµÊ∏ÖÂñÆ</p>
                <p>‰æùÂâ©È§òÂ§©Êï∏ÊéíÂ∫è,Êèê‰æõÂà∞ÊúüÊó•ÊèêÈÜíÂäüËÉΩ</p>
            </div>
            
            <div class="search-section">
                <div class="search-box" style="max-width: 400px;">
                    <select id="expiryFilter" style="flex: 1; padding: 15px; font-size: 1.2em; border: 2px solid #ddd; border-radius: 10px;">
                        <option value="30">30Â§©ÂÖßÂà∞Êúü</option>
                        <option value="90">90Â§©ÂÖßÂà∞Êúü</option>
                        <option value="180">180Â§©ÂÖßÂà∞Êúü</option>
                        <option value="365">1Âπ¥ÂÖßÂà∞Êúü</option>
                        <option value="all">ÂÖ®ÈÉ®È°ØÁ§∫</option>
                    </select>
                    <button onclick="searchExpiry()">Êü•Ë©¢</button>
                </div>
            </div>
            
            <div id="result4"></div>
        </div>
        
        <div class="footer">
            <p>¬© 2025 RexÂ§ßÂèîÁöÑ168Âè∞ËÇ°ÊäïË≥áÊïôÂÆ§ | CBÂèØËΩâÂÇµÁôºË°åË≥áÊñôÊü•Ë©¢Á≥ªÁµ± v1.0</p>
            <p style="margin-top: 8px; opacity: 0.8;">Ë≥áÊñôÂÉÖ‰æõÂèÉËÄÉ | ÊäïË≥áÊúâÈ¢®Èö™ÔºåÂÖ•Â∏ÇÈúÄË¨πÊÖé</p>
        </div>
    </div>

    <script>
        let cbData = null;
        const COL = {
            Â∫è: 0, ËÇ°Á•®‰ª£Á¢º: 1, CB‰ª£Á¢º: 2, CBÂêçÁ®±: 3, TCRIÊìî‰øù: 4, Êìî‰øù: 5, È°çÂ∫¶ÂÑÑ: 6,
            ÁôºË°åËΩâÊèõÂÉπÊ†º: 7, ÊéõÁâåÊó•Êúü: 8, Âà∞ÊúüÊó•: 9, Âπ¥Êúü: 10, ÊúÄÈ´òÂÉπ: 11, ÊúÄ‰ΩéÂÉπ: 12,
            Ê∫¢ÂÉπËΩâÊèõÁéá: 13, ËÇ°Êú¨: 14, Ë©¢ÂúàÁ´∂Êãç: 15, ÊâøÈä∑ÂïÜ: 16, Ëë£‰∫ãÊúÉ: 17, ÈÄÅ‰ª∂Êó•: 18,
            ÁîüÊïàÊó•: 19, Ë©¢ÂúàÁ´∂ÊãçÊó•: 20, ÂÖ¨Âëä‰ª£Êî∂ÂÉπÊ¨æ: 21, ÊéõÁâåÊó•: 22, CBASÊãÜËß£Êó•: 23,
            Ë≥£ÂõûÊó•1: 24, Ë≥£ÂõûÊó•2: 25, Ë≥£ÂõûÂÉπ1: 26, Ë≥£ÂõûÂÉπ2: 27, Ë≥£ÂõûÊÆñÂà©Áéá1: 28,
            Ë≥£ÂõûÊÆñÂà©Áéá2: 29, ÊèêÂâçË≥£ÂõûÊ¢ù‰ª∂: 30, Ë≥£ÂõûÊ¢ù‰ª∂: 31, Áî¢Ê•≠ÂàÜÈ°û: 32, Áî¢Ê•≠Âú∞‰Ωç: 33,
            Ë≥áÈáëÁî®ÈÄî: 34, ÁôºË°åÂÉπÊ†º: 35, Âà∞ÊúüÈÇÑÊú¨ÂÉπ: 36, ËΩâÊèõÈñãÂßãÊó•: 37, ÊúÄÊñ∞ËΩâÊèõÂÉπ: 38,
            ÊúÄÂæåËÇ°Á•®ÂÉπÊ†º: 39, CBÂèÉËÄÉÂÉπÊ†º: 40, Êñ∞ËΩâÊèõÂÉπÁîüÊïàÊó•: 41, CBÊúÄÊñ∞È§òÈ°ç: 42,
            ÊúÄËøëË≥£ÂõûÊ¨äÈñãÂßã: 43, ÊúÄËøëË≥£ÂõûÊ¨äÁµêÊùü: 44, ÊúÄËøëË≥£ÂõûÊ¨äÂÉπÊ†º: 45,
            ÂÖ¨Âè∏Âº∑Âà∂Ë¥ñÂõûÈñãÂßã: 46, ÂÖ¨Âè∏Âº∑Âà∂Ë¥ñÂõûÁµêÊùü: 47, Âº∑Âà∂Ë¥ñÂõûÂÉπÊ†º: 48, ÁµÇÊ≠¢Ê´ÉÊ™ØË≤∑Ë≥£Êó•: 49
        };
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            const tabs = ['manual', 'auto', 'list', 'expiry'];
            const index = tabs.indexOf(tabName);
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            document.querySelectorAll('.tab-btn')[index].classList.add('active');
            
            if (tabName === 'list' && cbData) {
                showFullList();
            }
        }
        
        window.onload = function() {
            loadExcelFile();
        };
        
        async function loadExcelFile() {
            const banner = document.getElementById('loadingBanner');
            const loadBtn = document.getElementById('loadDataBtn');
            
            try {
                const response = await fetch('cb_issue.xlsx');
                if (!response.ok) throw new Error('ÁÑ°Ê≥ïËºâÂÖ•Ê™îÊ°à');
                
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, {type: 'array'});
                
                const sheet = workbook.Sheets['allcbissue'];
                if (!sheet) throw new Error('Êâæ‰∏çÂà∞allcbissueÂ∑•‰ΩúË°®');
                
                cbData = XLSX.utils.sheet_to_json(sheet, {header: 1});
                const cbCount = cbData.length - 1;
                
                banner.className = 'loading-banner success';
                banner.textContent = `‚úÖ Ë≥áÊñôËºâÂÖ•ÊàêÂäü | ÂèØËΩâÂÇµÁ∏ΩÊï∏: ${cbCount} Ê™î`;
                
                loadBtn.textContent = '‚úÖ ËºâÂÖ•ÂÆåÊàê';
                loadBtn.style.background = 'rgba(40, 167, 69, 0.3)';
                
            } catch (error) {
                banner.className = 'loading-banner';
                banner.style.background = '#f8d7da';
                banner.style.borderColor = '#dc3545';
                banner.style.color = '#721c24';
                banner.textContent = `‚ùå ËºâÂÖ•Â§±Êïó: ${error.message}`;
                
                loadBtn.textContent = '‚ùå ËºâÂÖ•Â§±Êïó';
                loadBtn.style.background = 'rgba(220, 53, 69, 0.3)';
            }
        }
        
        function searchManual() {
            const code = document.getElementById('manualCode').value.trim();
            if (!code) { alert('Ë´ãËº∏ÂÖ•CB‰ª£Ëôü'); return; }
            if (!cbData) { alert('Ë≥áÊñôÂ∞öÊú™ËºâÂÖ•'); return; }
            
            document.getElementById('result1').innerHTML = '<div class="loading">Êü•Ë©¢‰∏≠...</div>';
            
            setTimeout(() => {
                let found = null;
                for (let i = 1; i < cbData.length; i++) {
                    if (String(cbData[i][COL.CB‰ª£Á¢º]).trim() === code) {
                        found = cbData[i];
                        break;
                    }
                }
                
                if (!found) {
                    document.getElementById('result1').innerHTML = 
                        '<div class="error-message"><h3>Êâæ‰∏çÂà∞CB‰ª£Ëôü: ' + code + '</h3></div>';
                    return;
                }
                
                displaySingleDetail(found, 'result1');
            }, 300);
        }
        
        function displaySingleDetail(row, targetId) {
            const highest = parseFloat(row[COL.ÊúÄÈ´òÂÉπ]) || 0;
            const lowest = parseFloat(row[COL.ÊúÄ‰ΩéÂÉπ]) || 0;
            const swing = highest && lowest ? ((highest - lowest) / lowest * 100).toFixed(1) : '0.0';
            
            const html = `
                <div class="summary-card">
                    <h3>${row[COL.CB‰ª£Á¢º]} ${row[COL.CBÂêçÁ®±]}</h3>
                    <div class="detail-grid">
                        <div class="detail-item highlight">
                            <div class="label">Ë¶èÊ®°</div>
                            <div class="value">${row[COL.È°çÂ∫¶ÂÑÑ] || '-'} ÂÑÑ</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Êìî‰øù</div>
                            <div class="value">${row[COL.Êìî‰øù] || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Âπ¥Êúü</div>
                            <div class="value">${row[COL.Âπ¥Êúü] || '-'} Âπ¥</div>
                        </div>
                        <div class="detail-item highlight">
                            <div class="label">ËΩâÊèõÂÉπ</div>
                            <div class="value">${row[COL.ÊúÄÊñ∞ËΩâÊèõÂÉπ] || row[COL.ÁôºË°åËΩâÊèõÂÉπÊ†º] || '-'} ÂÖÉ</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Ë©¢Âúà/Á´∂Êãç</div>
                            <div class="value">${row[COL.Ë©¢ÂúàÁ´∂Êãç] || '-'}</div>
                        </div>
                        <div class="detail-item ${highest > 130 ? 'highlight' : ''}">
                            <div class="label">ÊúÄÈ´òÂÉπ</div>
                            <div class="value">${row[COL.ÊúÄÈ´òÂÉπ] || '-'}</div>
                        </div>
                        <div class="detail-item ${lowest < 100 ? 'highlight' : ''}">
                            <div class="label">ÊúÄ‰ΩéÂÉπ</div>
                            <div class="value">${row[COL.ÊúÄ‰ΩéÂÉπ] || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">ÊåØÂπÖ</div>
                            <div class="value">${swing}%</div>
                        </div>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>Ë≥£ÂõûË≥áË®ä</h3>
                    <div class="table-wrapper">
                        <table style="font-size: 1em;">
                            <thead>
                                <tr>
                                    <th>Ë≥£ÂõûÊ¨°Êï∏</th>
                                    <th>Êó•Êúü</th>
                                    <th>ÂÉπÊ†º</th>
                                    <th>Âà©Áéá</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Ë≥£Âõû1</strong></td>
                                    <td>${row[COL.Ë≥£ÂõûÊó•1] || '-'}</td>
                                    <td><strong>${row[COL.Ë≥£ÂõûÂÉπ1] || '-'}</strong></td>
                                    <td>${row[COL.Ë≥£ÂõûÊÆñÂà©Áéá1] || '-'}%</td>
                                </tr>
                                <tr>
                                    <td><strong>Ë≥£Âõû2</strong></td>
                                    <td>${row[COL.Ë≥£ÂõûÊó•2] || '-'}</td>
                                    <td><strong>${row[COL.Ë≥£ÂõûÂÉπ2] || '-'}</strong></td>
                                    <td>${row[COL.Ë≥£ÂõûÊÆñÂà©Áéá2] || '-'}%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById(targetId).innerHTML = html;
        }
        
        function searchAuto() {
            const code = document.getElementById('autoCode').value.trim();
            if (!code) { alert('Ë´ãËº∏ÂÖ•ËÇ°Á•®‰ª£Ëôü'); return; }
            if (!cbData) { alert('Ë≥áÊñôÂ∞öÊú™ËºâÂÖ•'); return; }
            
            document.getElementById('result2').innerHTML = '<div class="loading">Êü•Ë©¢‰∏≠...</div>';
            
            setTimeout(() => {
                const results = [];
                for (let i = 1; i < cbData.length; i++) {
                    if (String(cbData[i][COL.ËÇ°Á•®‰ª£Á¢º]).trim() === code) {
                        results.push(cbData[i]);
                    }
                }
                
                if (results.length === 0) {
                    document.getElementById('result2').innerHTML = 
                        '<div class="error-message"><h3>Êü•ÁÑ°Ë≥áÊñô: ËÇ°Á•®‰ª£Ëôü ' + code + '</h3></div>';
                    return;
                }
                
                let html = `
                    <div class="summary-card">
                        <h3>ËÇ°Á•®‰ª£Ëôü ${code} ÁöÑÊâÄÊúâCBÁôºË°åË®òÈåÑ (ÂÖ±${results.length}Ê™î)</h3>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>CB‰ª£Ëôü</th>
                                    <th>CBÂêçÁ®±</th>
                                    <th>Ë¶èÊ®°</th>
                                    <th>Êìî‰øù</th>
                                    <th>Âπ¥Êúü</th>
                                    <th>ËΩâÊèõÂÉπ</th>
                                    <th>Ë©¢Âúà/Á´∂Êãç</th>
                                    <th>ÊúÄÈ´òÂÉπ</th>
                                    <th>ÊúÄ‰ΩéÂÉπ</th>
                                    <th>ÊåØÂπÖ</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                results.forEach(row => {
                    const highest = parseFloat(row[COL.ÊúÄÈ´òÂÉπ]) || 0;
                    const lowest = parseFloat(row[COL.ÊúÄ‰ΩéÂÉπ]) || 0;
                    const swing = highest && lowest ? ((highest - lowest) / lowest * 100).toFixed(1) : '-';
                    
                    html += `
                        <tr>
                            <td><strong>${row[COL.CB‰ª£Á¢º]}</strong></td>
                            <td>${row[COL.CBÂêçÁ®±]}</td>
                            <td>${row[COL.È°çÂ∫¶ÂÑÑ]}ÂÑÑ</td>
                            <td><span class="badge ${row[COL.Êìî‰øù] === 'ÊúâÊìî‰øù' ? 'badge-green' : 'badge-orange'}">${row[COL.Êìî‰øù] || '-'}</span></td>
                            <td>${row[COL.Âπ¥Êúü]}Âπ¥</td>
                            <td><strong>${row[COL.ÊúÄÊñ∞ËΩâÊèõÂÉπ] || row[COL.ÁôºË°åËΩâÊèõÂÉπÊ†º]}ÂÖÉ</strong></td>
                            <td><span class="badge ${row[COL.Ë©¢ÂúàÁ´∂Êãç] === 'Á´∂Êãç' ? 'badge-blue' : 'badge-green'}">${row[COL.Ë©¢ÂúàÁ´∂Êãç] || '-'}</span></td>
                            <td class="price-high">${row[COL.ÊúÄÈ´òÂÉπ] || '-'}</td>
                            <td class="price-low">${row[COL.ÊúÄ‰ΩéÂÉπ] || '-'}</td>
                            <td><strong>${swing}${swing !== '-' ? '%' : ''}</strong></td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table></div>';
                document.getElementById('result2').innerHTML = html;
            }, 300);
        }
        
        function showFullList() {
            if (!cbData) return;
            
            let html = `
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>CB‰ª£Ëôü</th>
                                <th>CBÂêçÁ®±</th>
                                <th>Ë¶èÊ®°</th>
                                <th>Êìî‰øù</th>
                                <th>Âπ¥Êúü</th>
                                <th>ËΩâÊèõÂÉπ</th>
                                <th>ÊéõÁâåÊó•</th>
                                <th>Âà∞ÊúüÊó•</th>
                                <th>ÊúÄÈ´òÂÉπ</th>
                                <th>ÊúÄ‰ΩéÂÉπ</th>
                                <th>ÊåØÂπÖ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            for (let i = 1; i < cbData.length; i++) {
                const row = cbData[i];
                const highest = parseFloat(row[COL.ÊúÄÈ´òÂÉπ]) || 0;
                const lowest = parseFloat(row[COL.ÊúÄ‰ΩéÂÉπ]) || 0;
                const swing = highest && lowest ? ((highest - lowest) / lowest * 100).toFixed(1) : '-';
                
                html += `
                    <tr>
                        <td><strong>${row[COL.CB‰ª£Á¢º]}</strong></td>
                        <td>${row[COL.CBÂêçÁ®±]}</td>
                        <td>${row[COL.È°çÂ∫¶ÂÑÑ]}ÂÑÑ</td>
                        <td><span class="badge ${row[COL.Êìî‰øù] === 'ÊúâÊìî‰øù' ? 'badge-green' : 'badge-orange'}">${row[COL.Êìî‰øù] || '-'}</span></td>
                        <td>${row[COL.Âπ¥Êúü]}Âπ¥</td>
                        <td>${row[COL.ÊúÄÊñ∞ËΩâÊèõÂÉπ] || row[COL.ÁôºË°åËΩâÊèõÂÉπÊ†º]}ÂÖÉ</td>
                        <td>${row[COL.ÊéõÁâåÊó•Êúü] || '-'}</td>
                        <td>${row[COL.Âà∞ÊúüÊó•] || '-'}</td>
                        <td class="price-high">${row[COL.ÊúÄÈ´òÂÉπ] || '-'}</td>
                        <td class="price-low">${row[COL.ÊúÄ‰ΩéÂÉπ] || '-'}</td>
                        <td><strong>${swing}${swing !== '-' ? '%' : ''}</strong></td>
                    </tr>
                `;
            }
            
            html += '</tbody></table></div>';
            document.getElementById('result3').innerHTML = html;
        }
        
        function searchExpiry() {
            if (!cbData) { alert('Ë≥áÊñôÂ∞öÊú™ËºâÂÖ•'); return; }
            
            const filterDays = document.getElementById('expiryFilter').value;
            const today = new Date();
            const results = [];
            
            for (let i = 1; i < cbData.length; i++) {
                const row = cbData[i];
                const expiryStr = row[COL.Âà∞ÊúüÊó•];
                if (!expiryStr) continue;
                
                const expiry = new Date(expiryStr);
                const diff = Math.floor((expiry - today) / (1000 * 60 * 60 * 24));
                
                if (filterDays === 'all' || diff <= parseInt(filterDays)) {
                    results.push({ row: row, days: diff });
                }
            }
            
            results.sort((a, b) => a.days - b.days);
            
            let html = `
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>CB‰ª£Ëôü</th>
                                <th>CBÂêçÁ®±</th>
                                <th>Âà∞ÊúüÊó•</th>
                                <th>Ââ©È§òÂ§©Êï∏</th>
                                <th>Âπ¥Êúü</th>
                                <th>ÊéõÁâåÊó•</th>
                                <th>ËΩâÊèõÂÉπ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            results.forEach(r => {
                const badgeClass = r.days < 30 ? 'badge-red' : 
                                   r.days < 90 ? 'badge-orange' : 
                                   r.days < 180 ? 'badge-blue' : 'badge-green';
                html += `
                    <tr>
                        <td><strong>${r.row[COL.CB‰ª£Á¢º]}</strong></td>
                        <td>${r.row[COL.CBÂêçÁ®±]}</td>
                        <td>${r.row[COL.Âà∞ÊúüÊó•]}</td>
                        <td><span class="badge ${badgeClass}">${r.days} Â§©</span></td>
                        <td>${r.row[COL.Âπ¥Êúü]}Âπ¥</td>
                        <td>${r.row[COL.ÊéõÁâåÊó•Êúü]}</td>
                        <td>${r.row[COL.ÊúÄÊñ∞ËΩâÊèõÂÉπ] || r.row[COL.ÁôºË°åËΩâÊèõÂÉπÊ†º]}ÂÖÉ</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            document.getElementById('result4').innerHTML = html || '<div class="error-message">Êü•ÁÑ°Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑË≥áÊñô</div>';
        }
        
        document.getElementById('manualCode').addEventListener('keypress', e => {
            if (e.key === 'Enter') searchManual();
        });
        document.getElementById('autoCode').addEventListener('keypress', e => {
            if (e.key === 'Enter') searchAuto();
        });
    </script>
</body>
</html>
